<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard - Migewlito</title>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/animate.css">
    <link rel="stylesheet" href="assets/css/icons.css">
    <link rel="stylesheet" href="assets/css/app-style.css">
    <link rel="stylesheet" href="assets/css/style-main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <style>
        body { background: var(--warna_6); }
        .content { padding-top: 110px; }
        @media (min-width:1200px){ .container{ max-width:992px; } }
        .menu-user a { padding: 10px 16px; border-radius: 5px; color: #fff; display: block; }
        .menu-user a:hover, .menu-user a.active { background: linear-gradient(90deg, var(--warna_3) 0%, rgba(112,127,235,0) 100%); color: #fff; }
        .menu-user a:hover.logout { background: linear-gradient(90deg, #811a1a 0%, rgba(112,127,235,0) 100%); }
        .card-gd.user { background: var(--warna_2); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; }
        .card-gd-primary { background: rgba(255,255,255,0.08); }
        .migewlito-avatar-big { width: 55px; height: 55px; border-radius: 999px; display: flex; align-items: center; justify-content: center; font-weight: 900; color: #000; background: var(--warna_3); overflow:hidden; }
        .migewlito-avatar-big img{ width:100%; height:100%; object-fit:cover; display:block; }
        .member { color: #e7ad30; background: #e7ad3014; border: 1px solid #e7ad3014; font-weight: 700; }
        .migewlito-card { background: transparent; border: none; }
        .migewlito-card .card-gd.user{ padding: 18px; }
        .migewlito-hr{ border-top: 1px solid rgba(255,255,255,0.18); margin: 18px 0; }
        .migewlito-history-row { padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.08); display: flex; justify-content: space-between; gap: 12px; align-items: center; }
        .migewlito-muted { opacity: .75; font-size: 12px; }
    </style>
</head>
<body style="overflow-x:hidden;">
<div class="modal fade modal-country" id="modalCountry" tabindex="-1" role="dialog" aria-labelledby="modalCountry" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title">Region & Language</h1>
                <button type="button" class="btn-close-popup" data-bs-dismiss="modal" aria-label="Close">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="#FFFFFF" aria-hidden="true" class="h-6 w-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="relative pb-4">
                    <h1 class="lokas-title">Select Region</h1>
                    <div class="card-country-container">
                        <div class="country-card">
                            <input type="radio" id="country-PH" name="country" class="radio-country">
                            <label class="mb-0" for="country-PH">
                                <img class="img-country-modal" src="assets/flags/ph.png" alt="Country" loading="lazy">
                                <span>Philippines - ₱</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="relative">
                    <h1 class="lokas-title">Available Language</h1>
                    <div class="card-language-container">
                        <div class="language-card">
                            <input type="radio" id="language-PH-en" name="language" class="radio-language">
                            <label class="mb-0" for="language-PH-en">
                                <span>English</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="save-country" id="saveCountry">Apply</button>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
    <nav class="navbar navbar-expand-lg fixed-top navbar-dark nav-container" style="">
        <div class="container">
            <div class="classflex">
                <div class="d-flex">
                    <a class="navbar-brand p-0 mr-2" href="index.html">
                        <img src="assets/images/banner1.png" alt="Logo Migewlito" class="rounded" height="24px" width="100px">
                    </a>
                </div>
                <div class="flex items-center gap-2">
                    <div class="pencarian-content-search mobile">
                        <form action="" method="POST" id="searchForm2" class="w-searchbar ser">
                            <div class="input-group">
                                <input type="text" class="input-isi" autocomplete="off" placeholder="Search game or product" id="searchInput2" name="searchInput2" value="">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="absolute h-5 w-5">
                                    <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </form>
                        <div class="search-container mobile" id="searchResultsContainer2"></div>
                    </div>
                    <div class="flex items-center gap-1">
                        <button class="navbar-toggler butmobilenav overnaybutton px-2 ml-2" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                            <svg id="icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 19 14" fill="none">
                                <path d="M1 7H17.5M1 13H17.5M1 1H17.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="collapse navbar-collapse menu-utama" id="navbarNavAltMarkup">
                <div class="navbar-nav navbar-navmobile" style="gap: 0.5rem;">
                    <a class="nav-item nav-link bang" href="index.html">Home</a>
                    <a class="nav-item nav-link bang" href="payment.html">Transaction</a>
                    <a class="nav-item nav-link bang" href="promotion.html">Promo</a>
                    <a type="button" href="#" class="nav-item nav-link bang" data-bs-toggle="modal" data-bs-target="#modalLogin">Login</a>
                </div>
                <div class="navbar-nav ml-auto d-none-mobile align-items-center" style="gap: 8px;">
                    <div class="flex items-center">
                        <div class="pencarian-content-search destop">
                            <form action="" method="POST" id="searchForm" class="w-searchbar ser">
                                <div class="input-group">
                                    <input type="text" class="input-isi" autocomplete="off" placeholder="Search game or product" id="searchInput" name="searchInput" value="">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="absolute h-5 w-5">
                                        <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </form>
                            <div class="search-container" id="searchResultsContainer"></div>
                        </div>
                    </div>
                    <div class="logdarf">
                        <a class="Hubungi-Kami-button masuk d-none" style="position: relative;top: 0px;" href="register.html">Register</a>
                        <div class="Hubungi-Kami-button masuk d-none" style="position: relative;top: 0px;" data-bs-toggle="modal" data-bs-target="#modalLogin">Login</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mobile-search-container">
            <div class="pencarian-content-search">
                <form action="" method="POST" id="searchForm2" class="w-searchbar ser">
                    <div class="input-group">
                        <input type="text" class="input-isi" autocomplete="off" placeholder="Search game or product" id="searchInput2" name="searchInput2" value="">
                    </div>
                </form>
                <div class="search-container" id="searchResultsContainer2"></div>
            </div>
        </div>
    </nav>
    <div class="overlay-navbar"></div>

    <div class="content" style="min-height:580px">
        <div class="container">
            <div class="row">
                <div class="col-lg-3">
                    <h5 class="mb-3">Main Menu</h5>
                    <div class="menu-user" id="migewlito-user-menu">
                        <a class="d-block mb-1 active" href="#" data-tab="dashboard"><i class="fa fa-home mr-2"></i> Dashboard</a>
                        <a class="d-block mb-1" href="#" data-tab="history"><i class="fa fa-history mr-2"></i> History</a>
                        <a class="d-block mb-1 d-none" href="admin.html" id="migewlito-admin-link"><i class="fa fa-cog mr-2"></i> Admin</a>
                        <a class="d-block mb-1 logout d-none" href="#" id="migewlito-logout-link"><i class="fa fa-sign-out mr-2"></i> Logout</a>
                        <a class="d-block mb-1" href="#" id="migewlito-login-link" data-migewlito-auth="1"><i class="fa fa-sign-in mr-2"></i> Login</a>
                    </div>
                </div>
                <div class="col-lg-9 col-12">
                    <div class="pb-4">
                        <h4 id="migewlito-page-title">Info Profile</h4>
                    </div>
                    <div id="account-root" class="migewlito-card"></div>
                </div>
            </div>
        </div>
    </div>
    <footer id="aboutus" class="bg-footer">
        <div style="background: var(--warna_7) !important;">
            <div class="footer-container">
                <div class="container" style="">
                    <div class="row">
                        <div class="col-lg-3 col-sm-12 mb-2">
                            <img src="assets/images/banner2.png" height="61" width="254" alt="Logo Migewlito" class="mb-3" loading="lazy">
                            <div class="text-foot-1 pb-3" style="font-size: 18px; font-weight: 500;">
                                The most affordable top-up platform for mobile legends and many more games!
                            </div>
                        </div>
                        <div class="col-lg-9 col-sm-12 padding-custom-wee">
                            <div class="d-flex flex-column align-items-start justify-content-center footer-way">
                                <span class="spn-footer-sig">The most affordable top-up platform<br>easy, fast, and 100% secure</span>
                                <div class="d-flex flex-row align-items-center justify-content-start img-spanpay">
                                    <span class="d-flex flex-row align-items-center justify-content-start payimg-car">
                                        <img class="payterimg" src="assets/images/method/1735370441_707367543297dea17a7f.webp" alt="payment-2" width="100" height="50">
                                        <img class="payterimg" src="assets/images/method/1735370432_a728d9110bc0331b94bc.webp" alt="payment-3" width="100" height="50">
                                        <img class="payterimg" src="assets/images/method/spoy.png" alt="payment-4" width="100" height="50">
                                    </span>
                                    <span class="spn20plus">and more popular payment methods</span>
                                </div>
                            </div>
                            <div class="row w-100 mt-5 pt-2">
                                <div class="col-lg-4 col-sm-12 mb-4">
                                    <div class="pb-3 text-sm" style="color: #fff !important;font-weight: bold;">Region & Language</div>
                                    <button type="button" class="country-button" data-bs-toggle="modal" data-bs-target="#modalCountry">
                                        <img class="img-country" src="assets/flags/ph.png" alt="Country" loading="lazy">
                                        <span class="text-country">Philippines</span>
                                        <svg class="arrow-co" xmlns="http://www.w3.org/2000/svg" width="12" height="24" viewBox="0 0 12 24">
                                            <path fill="currentColor" fill-rule="evenodd" d="M10.157 12.711L4.5 18.368l-1.414-1.414l4.95-4.95l-4.95-4.95L4.5 5.64l5.657 5.657a1 1 0 0 1 0 1.414"></path>
                                        </svg>
                                    </button>
                                </div>
                                <div class="col-lg-4 col-sm-12 mb-4">
                                    <div class="pb-2 text-sm" style="color: #fff !important;font-weight: bold;">Contact Us</div>
                                    <ul class="menu-list">
                                        <li><span>support@migewlito.com</span></li>
                                    </ul>
                                </div>
                                <div class="col-lg-4 col-sm-12 mb-4">
                                    <div class="pb-2 text-sm" style="color: #fff !important;font-weight: bold;">Information</div>
                                    <ul class="menu-list">
                                        <li><a href="terms-and-conditions.html" target="_blank">Terms & Conditions</a></li>
                                        <li><a href="privacy-policy.html" target="_blank">Privacy Policy</a></li>
                                        <li><a href="mailto:support@migewlito.com">Partnership</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="pt-3 pb-4 d-flex align-items-center justify-content-center text-center sifooter" style="margin-bottom: -50px;">
                        <span class="text-white">MIGEWLITO © 2024</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>
</div>
<a href=" javaScript:void();" class="back-to-top">
    <i class="fa fa-angle-double-up"></i>
</a>

<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/app-script.js"></script>
<script>
(function () {
    "use strict";
    var root = document.getElementById("account-root");
    var pageTitle = document.getElementById("migewlito-page-title");
    var adminLink = document.getElementById("migewlito-admin-link");
    var logoutLink = document.getElementById("migewlito-logout-link");
    var loginLink = document.getElementById("migewlito-login-link");
    var menu = document.getElementById("migewlito-user-menu");

    var isNested = (window.location.pathname || "").indexOf("/games/") !== -1 || (window.location.pathname || "").indexOf("/promo-detail/") !== -1;
    var prefix = isNested ? "../" : "";

    var apiPost = function (url, body) {
        return fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body || {}),
            cache: "no-store"
        }).then(function (r) { return r.json(); });
    };

    var apiGet = function (url) {
        return fetch(url, { cache: "no-store" }).then(function (r) { return r.json(); });
    };

    var setActiveTab = function (tab) {
        try {
            if (!menu) return;
            var links = menu.querySelectorAll("a[data-tab]");
            links.forEach(function (a) {
                a.classList.toggle("active", String(a.getAttribute("data-tab")) === tab);
            });
        } catch (e) {}
    };

    var renderLoggedOut = function () {
        if (pageTitle) pageTitle.textContent = "Info Profile";
        setActiveTab("dashboard");
        if (logoutLink) logoutLink.classList.add("d-none");
        if (adminLink) adminLink.classList.add("d-none");
        if (loginLink) loginLink.classList.remove("d-none");
        root.innerHTML = ""
            + "<div class=\"card-body card-gd user rounded-2xl\">"
            + "<div class=\"text-white\" style=\"font-weight:900;font-size:20px\">Welcome</div>"
            + "<div class=\"text-white\" style=\"opacity:.8;margin-top:6px\">Log in to view your profile dashboard.</div>"
            + "<div class=\"migewlito-hr\"></div>"
            + "<a href=\"#\" data-migewlito-auth=\"1\" class=\"btn btn-primary\" style=\"width:100%\">Login / Create account</a>"
            + "</div>";
    };

    var renderDashboard = function (user) {
        if (pageTitle) pageTitle.textContent = "Info Profile";
        setActiveTab("dashboard");
        var roleLabel = (String(user.role || "") === "admin") ? "Admin" : "Regular Member";
        var displayName = String(user.username || user.name || user.email || "").trim();
        var initial = (displayName.slice(0, 1) || "U").toUpperCase();
        var avatarUrl = String(user.avatar_url || "").trim();
        var avatarHtml = avatarUrl ? ("<img src=\"" + avatarUrl.replace(/\"/g, "&quot;") + "\" alt=\"\">") : initial;
        root.innerHTML = ""
            + "<div class=\"card-body card-gd user rounded-2xl\">"
            + "<div class=\"d-flex\" style=\"align-items:center\">"
            + "<div class=\"user-img d-flex justify-content-center align-items-center card-gd-primary mr-2\" style=\"width:55px;height:55px;border-radius:50%\">"
            + "<div class=\"migewlito-avatar-big\">" + avatarHtml + "</div>"
            + "</div>"
            + "<div>"
            + "<h5 class=\"mb-2\">Hi, " + displayName.replace(/</g, "&lt;").replace(/>/g, "&gt;") + "</h5>"
            + "<span class=\"inline-flex items-center member p-1 px-2 rounded\">" + roleLabel + "</span>"
            + "</div>"
            + "</div>"
            + "<div class=\"migewlito-hr\"></div>"
            + "</div>";
    };

    var renderHistory = function () {
        if (pageTitle) pageTitle.textContent = "History";
        setActiveTab("history");
        var orders = [];
        try { orders = JSON.parse(localStorage.getItem("migewlito_orders") || "[]") || []; } catch (e) { orders = []; }
        if (!Array.isArray(orders) || !orders.length) {
            root.innerHTML = "<div class=\"card-body card-gd user rounded-2xl\"><div class=\"text-white\" style=\"font-weight:900\">History</div><div class=\"text-white\" style=\"opacity:.8;margin-top:6px\">No transactions yet.</div></div>";
            return;
        }
        var rows = orders.slice(0, 50).map(function (o) {
            var id = String(o.order_id || "");
            var game = String(o.game || "");
            var total = String(o.total_display || "");
            var status = String(o.status || "PENDING");
            return "<div class=\"migewlito-history-row\">"
                + "<div class=\"text-white\" style=\"font-weight:800\">" + id + "<div class=\"migewlito-muted\">" + game + "</div></div>"
                + "<div class=\"text-white\" style=\"text-align:right\"><div style=\"font-weight:900\">" + total + "</div><div class=\"migewlito-muted\">" + status + "</div></div>"
                + "</div>";
        }).join("");
        root.innerHTML = "<div class=\"card-body card-gd user rounded-2xl\"><div class=\"text-white\" style=\"font-weight:900\">History</div>" + rows + "</div>";
    };

    apiGet("api/auth_me.php").then(function (res) {
        var user = res && res.success ? res.user : null;
        var tab = "";
        try { tab = new URLSearchParams(window.location.search || "").get("tab") || ""; } catch (e) { tab = ""; }

        if (!user) {
            renderLoggedOut();
        } else {
            if (logoutLink) logoutLink.classList.remove("d-none");
            if (loginLink) loginLink.classList.add("d-none");
            if (String(user.role || "") === "admin" && adminLink) adminLink.classList.remove("d-none");
            if (tab === "history") renderHistory();
            else renderDashboard(user);
        }

        if (menu) {
            menu.addEventListener("click", function (ev) {
                var a = ev.target && ev.target.closest ? ev.target.closest("a[data-tab]") : null;
                if (!a) return;
                ev.preventDefault();
                var t = String(a.getAttribute("data-tab") || "");
                if (t === "history") {
                    try { history.replaceState(null, "", "user.html?tab=history"); } catch (e) {}
                    renderHistory();
                } else {
                    try { history.replaceState(null, "", "user.html"); } catch (e) {}
                    if (user) renderDashboard(user);
                    else renderLoggedOut();
                }
            });
        }

        if (logoutLink) {
            logoutLink.addEventListener("click", function (ev) {
                ev.preventDefault();
                apiPost("api/auth_logout.php", {}).then(function () { window.location.reload(); }).catch(function () { window.location.reload(); });
            });
        }
    }).catch(function () {
        renderLoggedOut();
    });

    try {
        var saveBtn = document.getElementById("saveCountry");
        if (saveBtn) {
            saveBtn.addEventListener("click", function () {
                try {
                    if (window.bootstrap && bootstrap.Modal) {
                        var inst = bootstrap.Modal.getInstance(document.getElementById("modalCountry"));
                        if (inst) inst.hide();
                        return;
                    }
                } catch (e) {}
                try {
                    if (window.jQuery && window.jQuery.fn && window.jQuery.fn.modal) {
                        window.jQuery("#modalCountry").modal("hide");
                    }
                } catch (e) {}
            });
        }
    } catch (e) {}
})();
</script>
</body>
</html>
